# üìù Passo a Passo: Como Executar os Testes

## üéØ Objetivo

Este guia mostra como executar os testes unit√°rios do projeto, verificar a cobertura e entender os resultados.

---

## üìã Pr√©-requisitos

Antes de come√ßar, certifique-se de que:

‚úÖ Node.js est√° instalado (vers√£o 16 ou superior)  
‚úÖ Depend√™ncias do projeto est√£o instaladas  
‚úÖ Voc√™ est√° na pasta raiz do projeto

### Verificando os pr√©-requisitos

```bash
# Verificar vers√£o do Node.js
node --version

# Deve mostrar algo como: v16.x.x ou superior
```

### Instalando depend√™ncias (se necess√°rio)

```bash
# Na pasta raiz do projeto
npm install
```

---

## üöÄ Passo 1: Executar Todos os Testes

### Comando

```bash
npm test
```

### O que este comando faz?

Este comando executa **todos os testes** do projeto uma √∫nica vez.

### O que voc√™ ver√°

```
> alunos_senai@1.0.0 test
> jest

 PASS  __tests__/services/viaCep.test.ts
 PASS  __tests__/services/codigoBarras.test.ts
 PASS  __tests__/services/utils.test.ts
 PASS  __tests__/components/ClientCard.test.tsx
 PASS  __tests__/example.test.tsx

Test Suites: 5 passed, 5 total
Tests:       68 passed, 68 total
Snapshots:   0 total
Time:        4.5 s
```

### Interpretando os resultados

#### ‚úÖ Testes Passando (PASS)

```
 PASS  __tests__/services/viaCep.test.ts
```

- ‚úÖ **PASS** = Todos os testes deste arquivo passaram
- ‚úÖ Cor verde no terminal
- ‚úÖ Tudo funcionando como esperado

#### ‚ùå Testes Falham (FAIL)

Se aparecer algo assim:

```
 FAIL  __tests__/services/viaCep.test.ts
  ‚óè Servi√ßo ViaCEP ‚Ä∫ formatarCep ‚Ä∫ deve formatar CEP

    expect(received).toBe(expected)

    Expected: "01310-100"
    Received: "01310100"
```

Isso significa:
- ‚ùå **FAIL** = Pelo menos um teste falhou
- ‚ùå Cor vermelha no terminal
- ‚ùå Mostra o que era esperado vs o que foi recebido
- ‚ùå Indica linha onde o teste falhou

### Quando usar?

- ‚úÖ Antes de fazer commit
- ‚úÖ Depois de modificar c√≥digo
- ‚úÖ Para verificar se tudo est√° funcionando
- ‚úÖ Durante revis√£o de c√≥digo

### Executando testes espec√≠ficos

```bash
# Executar testes de um arquivo espec√≠fico
npm test -- __tests__/services/viaCep.test.ts

# Executar testes de uma pasta
npm test -- __tests__/services/

# Executar testes que cont√™m "CEP" no nome
npm test -- -t "CEP"
```

---

## üîÑ Passo 2: Modo Watch (Desenvolvimento)

### Comando

```bash
npm run test:watch
```

### O que este comando faz?

Este comando mant√©m os testes **rodando continuamente** e **reexecuta automaticamente** quando voc√™ salva um arquivo.

### O que voc√™ ver√°

```
 PASS  __tests__/services/viaCep.test.ts
 
Test Suites: 1 passed, 1 total
Tests:       20 passed, 20 total
Snapshots:   0 total
Time:        2.5 s

Watch Usage
 ‚Ä∫ Press a to run all tests.
 ‚Ä∫ Press f to run only failed tests.
 ‚Ä∫ Press p to filter by a filename regex pattern.
 ‚Ä∫ Press t to filter by a test name regex pattern.
 ‚Ä∫ Press q to quit watch mode.
 ‚Ä∫ Press Enter to trigger a test run.
```

### Op√ß√µes interativas do Watch Mode

Enquanto estiver rodando, voc√™ pode pressionar:

| Tecla | A√ß√£o |
|-------|------|
| `a` | Executar **todos** os testes |
| `f` | Executar apenas testes que **falharam** |
| `p` | Filtrar por **nome de arquivo** |
| `t` | Filtrar por **nome do teste** |
| `q` | **Sair** do modo watch |
| `Enter` | **Reexecutar** os testes |

### Fluxo de trabalho com Watch Mode

1. **Abra o terminal** e execute `npm run test:watch`
2. **Abra seu editor** de c√≥digo em outra janela
3. **Modifique o c√≥digo** ou os testes
4. **Salve o arquivo** (Ctrl+S)
5. **Os testes reexecutam automaticamente** ‚ú®
6. **Veja os resultados** no terminal
7. **Continue desenvolvendo** sem parar os testes

### Exemplo pr√°tico

```bash
# Terminal 1: Deixe rodando
npm run test:watch

# Terminal 2 ou Editor: Modifique o c√≥digo
# Salve o arquivo
# Terminal 1 mostra automaticamente os novos resultados!
```

### Quando usar?

- ‚úÖ Durante desenvolvimento ativo
- ‚úÖ Quando estiver escrevendo novos testes
- ‚úÖ Para feedback instant√¢neo
- ‚úÖ TDD (Test-Driven Development)

### Como parar?

Pressione `q` ou `Ctrl+C` no terminal.

---

## üìä Passo 3: Relat√≥rio de Cobertura

### Comando

```bash
npm run test:coverage
```

### O que este comando faz?

Este comando executa todos os testes e gera um **relat√≥rio detalhado** mostrando:
- Quantas linhas de c√≥digo foram testadas
- Quantas condi√ß√µes (if/else) foram testadas
- Quais linhas **n√£o** est√£o testadas

### O que voc√™ ver√° no terminal

```
 PASS  __tests__/services/viaCep.test.ts
 PASS  __tests__/services/codigoBarras.test.ts
 PASS  __tests__/services/utils.test.ts
 PASS  __tests__/components/ClientCard.test.tsx
 PASS  __tests__/example.test.tsx

------------------|---------|----------|---------|---------|-------------------
File              | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
------------------|---------|----------|---------|---------|-------------------
All files         |   10.04 |     9.14 |    7.44 |   10.06 |
 (tabs)           |       0 |        0 |       0 |       0 |
  about.tsx       |       0 |        0 |       0 |       0 | 17-408
  categories.tsx  |       0 |        0 |       0 |       0 | 25-315
  products.tsx    |       0 |        0 |       0 |       0 | 46-617
  stock.tsx       |       0 |        0 |       0 |       0 | 32-323
 services         |     100 |    96.66 |     100 |     100 |
  codigoBarras.ts |     100 |    95.83 |     100 |     100 | 110
  viaCep.ts       |     100 |      100 |     100 |     100 |
------------------|---------|----------|---------|---------|-------------------

Test Suites: 5 passed, 5 total
Tests:       68 passed, 68 total
Snapshots:   0 total
Time:        5.5 s
```

### Entendendo a tabela de cobertura

#### Colunas da tabela

| Coluna | O que significa | Exemplo |
|--------|-----------------|---------|
| **File** | Nome do arquivo | `viaCep.ts` |
| **% Stmts** | % de **declara√ß√µes** testadas | `100` = todas testadas |
| **% Branch** | % de **condi√ß√µes** (if/else) testadas | `100` = todos os caminhos testados |
| **% Funcs** | % de **fun√ß√µes** testadas | `100` = todas as fun√ß√µes testadas |
| **% Lines** | % de **linhas** testadas | `100` = todas as linhas testadas |
| **Uncovered Line #s** | Linhas **n√£o testadas** | `17-408` = linhas 17 a 408 sem testes |

#### Interpretando porcentagens

```
100%  ‚úÖ EXCELENTE  - C√≥digo totalmente testado
80-99% ‚ö†Ô∏è BOM      - Boa cobertura, poucas linhas sem testes
60-79% ‚ö†Ô∏è REGULAR  - Cobertura aceit√°vel, mas pode melhorar
< 60%  ‚ùå RUIM     - Muitas linhas sem testes, precisa melhorar
```

### Exemplo detalhado

```
services         |     100 |    96.66 |     100 |     100 |
  viaCep.ts      |     100 |      100 |     100 |     100 |
```

Isso significa:
- ‚úÖ **100% Stmts**: Todas as declara√ß√µes foram executadas pelos testes
- ‚úÖ **100% Branch**: Todos os if/else foram testados
- ‚úÖ **100% Funcs**: Todas as fun√ß√µes foram testadas
- ‚úÖ **100% Lines**: Todas as linhas foram executadas

### Visualizando o relat√≥rio HTML

Ap√≥s executar `npm run test:coverage`, um relat√≥rio HTML √© gerado automaticamente.

#### Passo 1: Localize o arquivo

```
coverage/
‚îî‚îÄ‚îÄ lcov-report/
    ‚îî‚îÄ‚îÄ index.html  ‚Üê ABRA ESTE ARQUIVO
```

#### Passo 2: Abra no navegador

**Op√ß√£o A - Pelo explorador de arquivos:**
1. Navegue at√© a pasta `coverage/lcov-report/`
2. Clique duas vezes em `index.html`
3. Abre no seu navegador padr√£o

**Op√ß√£o B - Por linha de comando:**

```bash
# Windows
start coverage/lcov-report/index.html

# Mac
open coverage/lcov-report/index.html

# Linux
xdg-open coverage/lcov-report/index.html
```

#### Passo 3: Navegue pelo relat√≥rio

O relat√≥rio HTML mostra:

1. **P√°gina inicial**: Lista de todos os arquivos e suas coberturas
   - Clique em uma pasta para ver arquivos dentro dela
   - Clique em um arquivo para ver detalhes

2. **P√°gina do arquivo**: C√≥digo fonte com destaque de cobertura
   - üü¢ **Verde**: Linhas testadas
   - üî¥ **Vermelho**: Linhas N√ÉO testadas
   - üü° **Amarelo**: Condi√ß√µes parcialmente testadas

3. **Exemplo visual**:

```javascript
   1 | export function formatarCep(cep: string): string {
   2 |   const cepLimpo = cep.replace(/\D/g, '');           // üü¢ Testada
   3 |   return cepLimpo.replace(/(\d{5})(\d{3})/, '$1-$2'); // üü¢ Testada
   4 | }
```

### Melhorando a cobertura

Se encontrar linhas vermelhas (n√£o testadas):

1. **Identifique** quais linhas n√£o t√™m testes
2. **Crie testes** para essas linhas
3. **Execute** `npm run test:coverage` novamente
4. **Verifique** se as linhas ficaram verdes

### Quando usar?

- ‚úÖ Antes de fazer um Pull Request
- ‚úÖ Para identificar c√≥digo sem testes
- ‚úÖ Para garantir qualidade do c√≥digo
- ‚úÖ Ao final de uma sprint/tarefa

---

## üéì Resumo dos Comandos

| Comando | Quando Usar | Resultado |
|---------|-------------|-----------|
| `npm test` | Antes de commit, verifica√ß√£o r√°pida | Executa todos os testes uma vez |
| `npm run test:watch` | Durante desenvolvimento | Reexecuta automaticamente ao salvar |
| `npm run test:coverage` | Antes de PR, verificar qualidade | Mostra cobertura detalhada |

---

## üí° Dicas Pr√°ticas

### Fluxo de trabalho recomendado

#### 1Ô∏è‚É£ Iniciando o desenvolvimento

```bash
# Terminal 1
npm run test:watch

# Continue programando e salvando
# Testes rodam automaticamente!
```

#### 2Ô∏è‚É£ Antes de fazer commit

```bash
# Parar o watch mode (Ctrl+C)
# Executar todos os testes
npm test

# Se tudo passou, fazer commit!
git add .
git commit -m "feat: adiciona nova funcionalidade"
```

#### 3Ô∏è‚É£ Antes de criar Pull Request

```bash
# Verificar cobertura
npm run test:coverage

# Abrir relat√≥rio HTML
start coverage/lcov-report/index.html

# Verificar se cobertura est√° boa (>80%)
# Se sim, criar PR!
```

### Atalhos √∫teis

```bash
# Executar apenas testes que falharam
npm test -- --onlyFailures

# Executar testes de um arquivo espec√≠fico
npm test viaCep

# Executar com mais detalhes (verbose)
npm test -- --verbose

# Limpar cache do Jest
npm test -- --clearCache
```

---

## üêõ Resolvendo Problemas Comuns

### Problema 1: "Test suite failed to run"

**Erro:**
```
Test suite failed to run
Cannot find module...
```

**Solu√ß√£o:**
```bash
# Reinstalar depend√™ncias
npm install

# Limpar cache do Jest
npm test -- --clearCache --no-cache

# Executar novamente
npm test
```

### Problema 2: Testes muito lentos

**Solu√ß√£o:**
```bash
# Executar apenas arquivos modificados
npm test -- --onlyChanged

# Executar em paralelo (mais r√°pido)
npm test -- --maxWorkers=4
```

### Problema 3: "Out of memory"

**Solu√ß√£o:**
```bash
# Aumentar mem√≥ria dispon√≠vel
NODE_OPTIONS=--max_old_space_size=4096 npm test
```

### Problema 4: Testes passam localmente mas falham no CI

**Causas comuns:**
- Depend√™ncias de tempo (setTimeout)
- Testes dependentes da ordem de execu√ß√£o
- Diferen√ßas de timezone

**Solu√ß√£o:**
```bash
# Executar testes em ordem aleat√≥ria
npm test -- --randomize

# Executar m√∫ltiplas vezes
npm test -- --testSequencer=@jest/test-sequencer
```

---

## üìö Recursos Adicionais

### Documenta√ß√£o do projeto

- üìñ [Guia Completo de JSDoc e Testes](./JSDOC_E_TESTES.md)
- ‚ö° [Guia R√°pido](./GUIA_RAPIDO_TESTES.md)
- üìä [Resumo da Implementa√ß√£o](./RESUMO_IMPLEMENTACAO.md)

### Documenta√ß√£o oficial

- [Jest - Getting Started](https://jestjs.io/docs/getting-started)
- [Jest - CLI Options](https://jestjs.io/docs/cli)
- [Testing Library](https://testing-library.com/docs/react-native-testing-library/intro)

### Exemplos no projeto

- `__tests__/services/viaCep.test.ts` - Testes de servi√ßo
- `__tests__/services/utils.test.ts` - Exemplos de boas pr√°ticas
- `__tests__/components/ClientCard.test.tsx` - Testes de componente

---

## ‚úÖ Checklist: Antes de Fazer Commit

Use este checklist para garantir qualidade:

```
‚ñ° Executei npm test e todos passaram
‚ñ° Executei npm run test:coverage
‚ñ° Cobertura est√° acima de 80% (ou manteve a mesma)
‚ñ° N√£o h√° linhas cr√≠ticas sem testes
‚ñ° Testes s√£o descritivos e claros
‚ñ° JSDoc est√° atualizado
‚ñ° C√≥digo est√° formatado
```

---

## üéØ Conclus√£o

Agora voc√™ sabe:

‚úÖ Como executar todos os testes com `npm test`  
‚úÖ Como usar modo watch durante desenvolvimento  
‚úÖ Como gerar e interpretar relat√≥rio de cobertura  
‚úÖ Como identificar e resolver problemas  
‚úÖ Boas pr√°ticas de fluxo de trabalho  

**Continue testando e mantendo seu c√≥digo com alta qualidade!** üöÄ

---

## üÜò Precisa de Ajuda?

Se encontrar problemas n√£o listados aqui:

1. Verifique a documenta√ß√£o oficial do Jest
2. Veja os exemplos nos arquivos de teste do projeto
3. Execute `npm test -- --help` para ver todas as op√ß√µes
4. Consulte `docs/JSDOC_E_TESTES.md` para mais detalhes

**Bons testes! üß™‚ú®**

